function IZIRequesterSocket(a,b,c,d){function e(a){n.acts("onAgentReplying",a)}function f(a,b){n.acts("onAgentHandle",a,b)}function g(a,b){n.socket.disconnect(),n.acts("onAgentBlock",a,b)}function h(a,b){n.socket.disconnect(),n.acts("onAgentClosed",a,b)}function i(a,b){n.acts("onAgentLeft",a,b)}function j(a,b){n.acts("onUserOnline",a,b)}function k(a,b){n.acts("onAgentMessage",a,b)}function l(a,b){n.acts("onTriggerMessage",a,b)}function m(a,b){n.acts("onAgentRequestRating",a,b)}var n=this,o=0,p={},q=(c||{}).izilog||function(){},r=(c||{}).localdata||new _LocalData,s=a+"/chat/requester";const t=new URLSearchParams({engine:"authToken",owner_id:b.ed_user_id,ssid:b._id,authorization:toAuthToken(r.localSetting(tokenHeader()))}).toString();q("[IZIRequesterSocket] connect",s,{transports:["websocket"],query:t});var u=io.connect(s,{transports:["websocket"],query:t});this.FuncCode={},this.MsgType={},this.session=b,this.timer={},u.on("disconnect",function(a){var b;try{b=JSON.parse(a)}catch(a){b={}}n.acts("onDisconnected",b)}),u.on("error",function(a){console.log(a)}),u.on("authentication",function(a){o++,n.FuncCode=a.FuncCode,n.MsgType=a.MsgType,1==o,1==o?(q("Connected"),(d||function(){})()):(q("Re-Connected"),n.acts("onReconnected"))}),u.on("trigger",function(a){if(q("Socket[trigger]: ",a),a.is_error)return q("Error",a);var b=a.funcCode,c=a.data,d=a.user;b===n.FuncCode.TMessage?l(d,c):q("No request case:",a,n.FuncCode)}),u.on("agent",function(a){if(q("Socket[agent]: ",a),a.is_error)return q("Error",a);var b=a.funcCode,c=a.data,d=a.user;b===n.FuncCode.SReplying?e(d):b===n.FuncCode.AMessage?k(d,c):b===n.FuncCode.AHandle?f(d,c):b===n.FuncCode.ABlock?g(d,c):b===n.FuncCode.ALeft?i(d,c):b===n.FuncCode.AClose?h(d,c):b===n.FuncCode.ARate?m(d,c):b===n.FuncCode.SOnline?j(d,c):q("No request case:",a,n.FuncCode)}),this.socket=u,this.acts=function(a,b,c,d,e){p[a]=p[a]||[],p[a].forEach(function(a){a(b,c,d,e)})},this.pushListener=function(a,b){p[a]=p[a]||[],p[a].push(b)},this.request=function(a,b,c){if(c=c||function(){},!n.session)return c("chat.session.not_found");if(n.socket.disconnected)return c("chat.socket.not_connected");var d={funcCode:a,session_id:n.session._id,data:b};n.socket.emit("request",d,c||function(){})},this.updateSession=function(a){n.session=a},this.socket=u}IZIRequesterSocket.prototype.sendMessage=function(a,b){var c=this.MsgType.Comment;this.request(this.FuncCode.VMessage,{msg_content:a,msg_type:c},b)},IZIRequesterSocket.prototype.sendAttachment=function(a,b){var c=this.MsgType.File;this.request(this.FuncCode.VMessage,{attachment:a,msg_type:c},b)},IZIRequesterSocket.prototype.replying=function(){this.request(this.FuncCode.SReplying)},IZIRequesterSocket.prototype.chatRated=function(){this.request(this.FuncCode.VRated)},IZIRequesterSocket.prototype.requestChat=function(){this.request(this.FuncCode.VRequest)},IZIRequesterSocket.prototype.isConnected=function(){return this.socket.connected};