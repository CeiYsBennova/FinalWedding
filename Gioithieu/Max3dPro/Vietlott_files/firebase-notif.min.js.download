var _FireBaseNotif=function(){function d(){try{new Promise(function(a,b){navigator.serviceWorker.register("./js/firebase/firebase-messaging-sw.js").then(a,b)}).then(function(b){return new Promise(function(c,d){a.useServiceWorker(b),a.getToken().then(e,function(a){__iziconfig.isDebug()&&console.log(a),b.unregister(),b=null})})}).then(function(){__iziconfig.isDebug()&&console.log("Register SW Successful!")}).catch(function(a){__iziconfig.isDebug()&&console.log(a)})}catch(a){__iziconfig.isDebug()&&console.log("Background Notification"+a)}}function e(a){return new Promise(function(b,c){window.chatUtils.ajax("/api/chat/requester/chat-notif","post",{token:a},function(a){return a.errors?c(a.errors):b(a)})})}function f(a){if(a.origin==c)try{if("notif-request-granted"==JSON.parse(a.data).topic)return d()}catch(a){__iziconfig.isDebug()&&console.log(a)}}function g(a){return a.protocol+"//"+a.host}var a=null,c="*";this.init=function(b){return b=b||{},window.Promise?window.Notification?navigator.serviceWorker?"https:"!=window.location.protocol?void(__iziconfig.isDebug()&&console.log("Background Notification only supports HTTPS")):window.isSecureContext?(c=g(b.location)||c,a||(a=firebase.initializeApp({messagingSenderId:__iziconfig.get("msgSenderId")}).messaging(),a.onTokenRefresh(function(){a.getToken().then(e).catch(function(a){__iziconfig.isDebug()&&console.log(a)})})),void(window.parent==window?a.requestPermission().then(d).catch(function(a){__iziconfig.isDebug()&&console.log(a)}):window.parent.postMessage('{"topic":"safe-exec","command":"Notification.requestPermission().then(function(result) { if(result == \\"granted\\") { iframe.contentWindow.postMessage(\'{\\"topic\\":\\"notif-request-granted\\"}\', \\"'+g(window.location)+'\\") } });"}',c))):void(__iziconfig.isDebug()&&console.log("Background Notification is not a secure context")):void(__iziconfig.isDebug()&&console.log("Background Notification does not support ServiceWorker")):void(__iziconfig.isDebug()&&console.log("Background Notification does not support Notification")):void(__iziconfig.isDebug()&&console.log("Background Notification does not support Promise"))},window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent&&window.attachEvent("onmessage",f)};
